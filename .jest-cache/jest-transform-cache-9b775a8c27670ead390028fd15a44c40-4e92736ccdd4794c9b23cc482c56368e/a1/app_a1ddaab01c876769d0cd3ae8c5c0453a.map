{"version":3,"names":["express","require","mongoose","cors","helmet","morgan","swaggerUi","swaggerSpecs","rateLimit","config","app","module","exports","error","status","msg","err","Error","process","env","NODE_ENV","connect","MONGODB_URI","then","console","log","catch","exit","use","json","apiLimiter","windowMs","max","message","standardHeaders","legacyHeaders","authLimiter","apartmentWriteLimiter","serve","setup","explorer","customCss","customSiteTitle","authRoutes","apartmentRoutes","favoriteRoutes","commuteRoutes","userRoutes","req","res","next","stack","name","details","Object","values","errors","map","e","undefined","main","port","PORT","listen"],"sources":["app.js"],"sourcesContent":["'use strict';\n\n/**\n * Module dependencies.\n */\n\nconst express = require('express');\nconst mongoose = require('mongoose');\nconst cors = require('cors');\nconst helmet = require('helmet');\nconst morgan = require('morgan');\nconst swaggerUi = require('swagger-ui-express');\nconst swaggerSpecs = require('./config/swagger');\nconst rateLimit = require('express-rate-limit');\nrequire('dotenv').config();\n\nconst app = (module.exports = express());\n\n// create an error with .status. we\n// can then use the property in our\n// custom error handler (Connect respects this prop as well)\nfunction error(status, msg) {\n  const err = new Error(msg);\n  err.status = status;\n  return err;\n}\n\n// Connect to MongoDB only if not in test environment\nif (process.env.NODE_ENV !== 'test') {\n  mongoose\n    .connect(process.env.MONGODB_URI)\n    .then(() => {\n      console.log('Connected to MongoDB');\n    })\n    .catch((err) => {\n      console.error('MongoDB connection error:', err);\n      process.exit(1);\n    });\n}\n\n// Middleware\napp.use(helmet()); // Security headers\napp.use(cors()); // Enable CORS\napp.use(express.json()); // Parse JSON bodies\napp.use(morgan('dev')); // Logging\n\n// Rate limiting middleware\nconst apiLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // Limit each IP to 100 requests per windowMs\n  message: { error: 'Too many requests, please try again later.' },\n  standardHeaders: true, // Return rate limit info in the `RateLimit-*` headers\n  legacyHeaders: false, // Disable the `X-RateLimit-*` headers\n});\n\n// Stricter rate limit for authentication endpoints\nconst authLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // 1 hour\n  max: 5, // Limit each IP to 5 requests per windowMs\n  message: { error: 'Too many authentication attempts, please try again later.' },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Stricter rate limit for apartment creation/updates\nconst apartmentWriteLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // 1 hour\n  max: 20, // Limit each IP to 20 requests per windowMs\n  message: { error: 'Too many apartment modifications, please try again later.' },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Apply rate limiting to routes\napp.use('/api/auth/', authLimiter); // Stricter limits for auth routes\napp.use('/api/apartments', apartmentWriteLimiter); // Stricter limits for apartment modifications\napp.use('/api/', apiLimiter); // General rate limit for all other routes\n\n// Swagger Documentation\napp.use(\n  '/api-docs',\n  swaggerUi.serve,\n  swaggerUi.setup(swaggerSpecs, {\n    explorer: true,\n    customCss: '.swagger-ui .topbar { display: none }',\n    customSiteTitle: 'Apartment Flow API Documentation',\n  })\n);\n\n// Import routes\nconst authRoutes = require('./routes/auth.routes');\nconst apartmentRoutes = require('./routes/apartment.routes');\nconst favoriteRoutes = require('./routes/favorite.routes');\nconst commuteRoutes = require('./routes/commute.routes');\nconst userRoutes = require('./routes/user.routes');\n\n// Routes\napp.use('/api/auth', authRoutes);\napp.use('/api/apartments', apartmentRoutes);\napp.use('/api/favorites', favoriteRoutes);\napp.use('/api/commute', commuteRoutes);\napp.use('/api/users', userRoutes);\n\n// Error handling middleware\napp.use(function (err, req, res, next) {\n  // Log error for debugging\n  console.error(err.stack);\n\n  // Handle mongoose validation errors\n  if (err.name === 'ValidationError') {\n    return res.status(400).json({\n      error: 'Validation Error',\n      details: Object.values(err.errors).map((e) => e.message),\n    });\n  }\n\n  // Handle mongoose cast errors (invalid ObjectId)\n  if (err.name === 'CastError') {\n    return res.status(400).json({\n      error: 'Invalid ID format',\n      details: err.message,\n    });\n  }\n\n  // Handle JWT errors\n  if (err.name === 'JsonWebTokenError') {\n    return res.status(401).json({\n      error: 'Invalid token',\n      details: 'Please log in again',\n    });\n  }\n\n  // Handle JWT expiration\n  if (err.name === 'TokenExpiredError') {\n    return res.status(401).json({\n      error: 'Token expired',\n      details: 'Please log in again',\n    });\n  }\n\n  // Default error\n  res.status(err.status || 500).json({\n    error: err.message || 'Internal Server Error',\n    details: process.env.NODE_ENV === 'development' ? err.stack : undefined,\n  });\n});\n\n// 404 handler (from Express.js web-service example)\napp.use(function (req, res) {\n  res.status(404);\n  res.json({ error: \"Sorry, can't find that\" });\n});\n\n// Start server\nif (require.main === module) {\n  const port = process.env.PORT || 3000;\n  app.listen(port, () => {\n    console.log(`Server is running on port ${port}`);\n  });\n}\n\nmodule.exports = app;\n// test\n"],"mappings":"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","ignoreList":[]}