07a2266c7b47b91610d24d2e895a8d7b
const request = require('supertest');
const mongoose = require('mongoose');
const app = require('../app');
const User = require('../models/user.model');
const jwt = require('jsonwebtoken');
describe('User Profile Management', () => {
  let testUser;
  let authToken;
  beforeEach(async () => {
    // Create a test user
    testUser = await User.create({
      email: 'test@example.com',
      password: 'password123',
      name: 'Test User',
      profileImage: 'default-avatar.jpg'
    });

    // Generate auth token
    authToken = jwt.sign({
      id: testUser._id
    }, process.env.JWT_SECRET, {
      expiresIn: '1d'
    });
  });
  afterEach(async () => {
    // Clean up test user
    await User.deleteMany({});
  });
  describe('GET /api/users/profile', () => {
    it('should get user profile when authenticated', async () => {
      const response = await request(app).get('/api/users/profile').set('Authorization', `Bearer ${authToken}`);
      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('email', 'test@example.com');
      expect(response.body).toHaveProperty('name', 'Test User');
      expect(response.body).toHaveProperty('profileImage', 'default-avatar.jpg');
    });
    it('should not get user profile without authentication', async () => {
      const response = await request(app).get('/api/users/profile');
      expect(response.status).toBe(401);
    });
  });
  describe('PUT /api/users/profile', () => {
    it('should update user profile when authenticated', async () => {
      const updateData = {
        name: 'Updated Name',
        profileImage: 'new-avatar.jpg'
      };
      const response = await request(app).put('/api/users/profile').set('Authorization', `Bearer ${authToken}`).send(updateData);
      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('name', 'Updated Name');
      expect(response.body).toHaveProperty('profileImage', 'new-avatar.jpg');
    });
    it('should not update user profile without authentication', async () => {
      const response = await request(app).put('/api/users/profile').send({
        name: 'Should Not Update'
      });
      expect(response.status).toBe(401);
    });
  });
  describe('DELETE /api/users/profile', () => {
    it('should delete user profile when authenticated', async () => {
      const response = await request(app).delete('/api/users/profile').set('Authorization', `Bearer ${authToken}`);
      expect(response.status).toBe(200);

      // Verify user is deleted
      const deletedUser = await User.findById(testUser._id);
      expect(deletedUser).toBeNull();
    });
    it('should not delete user profile without authentication', async () => {
      const response = await request(app).delete('/api/users/profile');
      expect(response.status).toBe(401);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsIm1vbmdvb3NlIiwiYXBwIiwiVXNlciIsImp3dCIsImRlc2NyaWJlIiwidGVzdFVzZXIiLCJhdXRoVG9rZW4iLCJiZWZvcmVFYWNoIiwiY3JlYXRlIiwiZW1haWwiLCJwYXNzd29yZCIsIm5hbWUiLCJwcm9maWxlSW1hZ2UiLCJzaWduIiwiaWQiLCJfaWQiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsImFmdGVyRWFjaCIsImRlbGV0ZU1hbnkiLCJpdCIsInJlc3BvbnNlIiwiZ2V0Iiwic2V0IiwiZXhwZWN0Iiwic3RhdHVzIiwidG9CZSIsImJvZHkiLCJ0b0hhdmVQcm9wZXJ0eSIsInVwZGF0ZURhdGEiLCJwdXQiLCJzZW5kIiwiZGVsZXRlIiwiZGVsZXRlZFVzZXIiLCJmaW5kQnlJZCIsInRvQmVOdWxsIl0sInNvdXJjZXMiOlsidXNlci50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcclxuY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5jb25zdCBhcHAgPSByZXF1aXJlKCcuLi9hcHAnKTtcclxuY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy91c2VyLm1vZGVsJyk7XHJcbmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpO1xyXG5cclxuZGVzY3JpYmUoJ1VzZXIgUHJvZmlsZSBNYW5hZ2VtZW50JywgKCkgPT4ge1xyXG4gIGxldCB0ZXN0VXNlcjtcclxuICBsZXQgYXV0aFRva2VuO1xyXG5cclxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcclxuICAgIC8vIENyZWF0ZSBhIHRlc3QgdXNlclxyXG4gICAgdGVzdFVzZXIgPSBhd2FpdCBVc2VyLmNyZWF0ZSh7XHJcbiAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLFxyXG4gICAgICBuYW1lOiAnVGVzdCBVc2VyJyxcclxuICAgICAgcHJvZmlsZUltYWdlOiAnZGVmYXVsdC1hdmF0YXIuanBnJyxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEdlbmVyYXRlIGF1dGggdG9rZW5cclxuICAgIGF1dGhUb2tlbiA9IGp3dC5zaWduKHsgaWQ6IHRlc3RVc2VyLl9pZCB9LCBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCB7XHJcbiAgICAgIGV4cGlyZXNJbjogJzFkJyxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gQ2xlYW4gdXAgdGVzdCB1c2VyXHJcbiAgICBhd2FpdCBVc2VyLmRlbGV0ZU1hbnkoe30pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnR0VUIC9hcGkvdXNlcnMvcHJvZmlsZScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZ2V0IHVzZXIgcHJvZmlsZSB3aGVuIGF1dGhlbnRpY2F0ZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLmdldCgnL2FwaS91c2Vycy9wcm9maWxlJylcclxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdlbWFpbCcsICd0ZXN0QGV4YW1wbGUuY29tJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnbmFtZScsICdUZXN0IFVzZXInKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdwcm9maWxlSW1hZ2UnLCAnZGVmYXVsdC1hdmF0YXIuanBnJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG5vdCBnZXQgdXNlciBwcm9maWxlIHdpdGhvdXQgYXV0aGVudGljYXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLmdldCgnL2FwaS91c2Vycy9wcm9maWxlJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwMSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1BVVCAvYXBpL3VzZXJzL3Byb2ZpbGUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB1c2VyIHByb2ZpbGUgd2hlbiBhdXRoZW50aWNhdGVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdVcGRhdGVkIE5hbWUnLFxyXG4gICAgICAgIHByb2ZpbGVJbWFnZTogJ25ldy1hdmF0YXIuanBnJyxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLnB1dCgnL2FwaS91c2Vycy9wcm9maWxlJylcclxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKVxyXG4gICAgICAgIC5zZW5kKHVwZGF0ZURhdGEpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ25hbWUnLCAnVXBkYXRlZCBOYW1lJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgncHJvZmlsZUltYWdlJywgJ25ldy1hdmF0YXIuanBnJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG5vdCB1cGRhdGUgdXNlciBwcm9maWxlIHdpdGhvdXQgYXV0aGVudGljYXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLnB1dCgnL2FwaS91c2Vycy9wcm9maWxlJylcclxuICAgICAgICAuc2VuZCh7IG5hbWU6ICdTaG91bGQgTm90IFVwZGF0ZScgfSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDQwMSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0RFTEVURSAvYXBpL3VzZXJzL3Byb2ZpbGUnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSB1c2VyIHByb2ZpbGUgd2hlbiBhdXRoZW50aWNhdGVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgIC5kZWxldGUoJy9hcGkvdXNlcnMvcHJvZmlsZScpXHJcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YCk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XHJcblxyXG4gICAgICAvLyBWZXJpZnkgdXNlciBpcyBkZWxldGVkXHJcbiAgICAgIGNvbnN0IGRlbGV0ZWRVc2VyID0gYXdhaXQgVXNlci5maW5kQnlJZCh0ZXN0VXNlci5faWQpO1xyXG4gICAgICBleHBlY3QoZGVsZXRlZFVzZXIpLnRvQmVOdWxsKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG5vdCBkZWxldGUgdXNlciBwcm9maWxlIHdpdGhvdXQgYXV0aGVudGljYXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLmRlbGV0ZSgnL2FwaS91c2Vycy9wcm9maWxlJyk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9u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QkwsTUFBTSxDQUFDSCxRQUFRLENBQUNJLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO01BQ2pDRixNQUFNLENBQUNILFFBQVEsQ0FBQ00sSUFBSSxDQUFDLENBQUNDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsY0FBYyxDQUFDO01BQzVESixNQUFNLENBQUNILFFBQVEsQ0FBQ00sSUFBSSxDQUFDLENBQUNDLGNBQWMsQ0FBQyxjQUFjLEVBQUUsZ0JBQWdCLENBQUM7SUFDeEUsQ0FBQyxDQUFDO0lBRUZSLEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxZQUFZO01BQ3RFLE1BQU1DLFFBQVEsR0FBRyxNQUFNekIsT0FBTyxDQUFDRyxHQUFHLENBQUMsQ0FDaEMrQixHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FDekJDLElBQUksQ0FBQztRQUFFdEIsSUFBSSxFQUFFO01BQW9CLENBQUMsQ0FBQztNQUV0Q2UsTUFBTSxDQUFDSCxRQUFRLENBQUNJLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ25DLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztFQUVGeEIsUUFBUSxDQUFDLDJCQUEyQixFQUFFLE1BQU07SUFDMUNrQixFQUFFLENBQUMsK0NBQStDLEVBQUUsWUFBWTtNQUM5RCxNQUFNQyxRQUFRLEdBQUcsTUFBTXpCLE9BQU8sQ0FBQ0csR0FBRyxDQUFDLENBQ2hDaUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQzVCVCxHQUFHLENBQUMsZUFBZSxFQUFFLFVBQVVuQixTQUFTLEVBQUUsQ0FBQztNQUU5Q29CLE1BQU0sQ0FBQ0gsUUFBUSxDQUFDSSxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBQzs7TUFFakM7TUFDQSxNQUFNTyxXQUFXLEdBQUcsTUFBTWpDLElBQUksQ0FBQ2tDLFFBQVEsQ0FBQy9CLFFBQVEsQ0FBQ1UsR0FBRyxDQUFDO01BQ3JEVyxNQUFNLENBQUNTLFdBQVcsQ0FBQyxDQUFDRSxRQUFRLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUM7SUFFRmYsRUFBRSxDQUFDLHVEQUF1RCxFQUFFLFlBQVk7TUFDdEUsTUFBTUMsUUFBUSxHQUFHLE1BQU16QixPQUFPLENBQUNHLEdBQUcsQ0FBQyxDQUFDaUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDO01BRWhFUixNQUFNLENBQUNILFFBQVEsQ0FBQ0ksTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDbkMsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119