{"version":3,"names":["jwt","require","User","protect","req","res","next","token","headers","authorization","startsWith","split","status","json","error","decoded","verify","process","env","JWT_SECRET","user","findById","id","select","console","authorize","roles","includes","role","module","exports"],"sources":["auth.middleware.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\nconst User = require('../models/user.model');\n\nconst protect = async (req, res, next) => {\n  try {\n    let token;\n\n    if (req.headers.authorization?.startsWith('Bearer')) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n\n    if (!token) {\n      return res.status(401).json({ error: 'Not authorized to access this route' });\n    }\n\n    try {\n      // Verify token\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n      // Get user from token\n      const user = await User.findById(decoded.id).select('-password');\n\n      if (!user) {\n        return res.status(401).json({ error: 'User not found' });\n      }\n\n      // Attach the full user object to the request\n      req.user = user;\n      next();\n    } catch (error) {\n      console.error('Token verification error:', error);\n      return res.status(401).json({ error: 'Not authorized to access this route' });\n    }\n  } catch (error) {\n    next(error);\n  }\n};\n\nconst authorize = (...roles) => {\n  return (req, res, next) => {\n    if (!req.user || !roles.includes(req.user.role)) {\n      return res.status(403).json({\n        error: `User role ${req.user?.role || 'none'} is not authorized to access this route`,\n      });\n    }\n    next();\n  };\n};\n\nmodule.exports = {\n  protect,\n  authorize,\n};\n"],"mappings":"AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAC,cAAc,CAAC;AACnC,MAAMC,IAAI,GAAGD,OAAO,CAAC,sBAAsB,CAAC;AAE5C,MAAME,OAAO,GAAG,MAAAA,CAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EACxC,IAAI;IACF,IAAIC,KAAK;IAET,IAAIH,GAAG,CAACI,OAAO,CAACC,aAAa,EAAEC,UAAU,CAAC,QAAQ,CAAC,EAAE;MACnDH,KAAK,GAAGH,GAAG,CAACI,OAAO,CAACC,aAAa,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACjD;IAEA,IAAI,CAACJ,KAAK,EAAE;MACV,OAAOF,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,KAAK,EAAE;MAAsC,CAAC,CAAC;IAC/E;IAEA,IAAI;MACF;MACA,MAAMC,OAAO,GAAGf,GAAG,CAACgB,MAAM,CAACT,KAAK,EAAEU,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC;;MAEzD;MACA,MAAMC,IAAI,GAAG,MAAMlB,IAAI,CAACmB,QAAQ,CAACN,OAAO,CAACO,EAAE,CAAC,CAACC,MAAM,CAAC,WAAW,CAAC;MAEhE,IAAI,CAACH,IAAI,EAAE;QACT,OAAOf,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;UAAEC,KAAK,EAAE;QAAiB,CAAC,CAAC;MAC1D;;MAEA;MACAV,GAAG,CAACgB,IAAI,GAAGA,IAAI;MACfd,IAAI,CAAC,CAAC;IACR,CAAC,CAAC,OAAOQ,KAAK,EAAE;MACdU,OAAO,CAACV,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD,OAAOT,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,KAAK,EAAE;MAAsC,CAAC,CAAC;IAC/E;EACF,CAAC,CAAC,OAAOA,KAAK,EAAE;IACdR,IAAI,CAACQ,KAAK,CAAC;EACb;AACF,CAAC;AAED,MAAMW,SAAS,GAAGA,CAAC,GAAGC,KAAK,KAAK;EAC9B,OAAO,CAACtB,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;IACzB,IAAI,CAACF,GAAG,CAACgB,IAAI,IAAI,CAACM,KAAK,CAACC,QAAQ,CAACvB,GAAG,CAACgB,IAAI,CAACQ,IAAI,CAAC,EAAE;MAC/C,OAAOvB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,KAAK,EAAE,aAAaV,GAAG,CAACgB,IAAI,EAAEQ,IAAI,IAAI,MAAM;MAC9C,CAAC,CAAC;IACJ;IACAtB,IAAI,CAAC,CAAC;EACR,CAAC;AACH,CAAC;AAEDuB,MAAM,CAACC,OAAO,GAAG;EACf3B,OAAO;EACPsB;AACF,CAAC","ignoreList":[]}