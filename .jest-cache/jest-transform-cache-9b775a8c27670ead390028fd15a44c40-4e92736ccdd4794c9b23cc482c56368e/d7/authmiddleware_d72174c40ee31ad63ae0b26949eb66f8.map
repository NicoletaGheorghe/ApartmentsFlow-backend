{"version":3,"names":["verifyToken","require","User","protect","req","res","next","authHeader","headers","authorization","startsWith","status","json","message","token","split","decoded","userId","id","user","findById","error","module","exports"],"sources":["auth.middleware.js"],"sourcesContent":["const { verifyToken } = require('../utils/jwt');\r\nconst User = require('../models/user.model');\r\n\r\nconst protect = async (req, res, next) => {\r\n  try {\r\n    const authHeader = req.headers.authorization;\r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n      return res.status(401).json({ message: 'Not authorized' });\r\n    }\r\n\r\n    const token = authHeader.split(' ')[1];\r\n    const decoded = verifyToken(token);\r\n\r\n    // Check for both userId and id in the decoded token\r\n    const userId = decoded.userId || decoded.id;\r\n    if (!userId) {\r\n      return res.status(401).json({ message: 'Invalid token' });\r\n    }\r\n\r\n    const user = await User.findById(userId);\r\n    if (!user) {\r\n      return res.status(401).json({ message: 'User not found' });\r\n    }\r\n\r\n    req.user = user;\r\n    next();\r\n  } catch (error) {\r\n    res.status(401).json({ message: 'Not authorized' });\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  protect,\r\n};\r\n"],"mappings":"AAAA,MAAM;EAAEA;AAAY,CAAC,GAAGC,OAAO,CAAC,cAAc,CAAC;AAC/C,MAAMC,IAAI,GAAGD,OAAO,CAAC,sBAAsB,CAAC;AAE5C,MAAME,OAAO,GAAG,MAAAA,CAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EACxC,IAAI;IACF,MAAMC,UAAU,GAAGH,GAAG,CAACI,OAAO,CAACC,aAAa;IAC5C,IAAI,CAACF,UAAU,IAAI,CAACA,UAAU,CAACG,UAAU,CAAC,SAAS,CAAC,EAAE;MACpD,OAAOL,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAiB,CAAC,CAAC;IAC5D;IAEA,MAAMC,KAAK,GAAGP,UAAU,CAACQ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACtC,MAAMC,OAAO,GAAGhB,WAAW,CAACc,KAAK,CAAC;;IAElC;IACA,MAAMG,MAAM,GAAGD,OAAO,CAACC,MAAM,IAAID,OAAO,CAACE,EAAE;IAC3C,IAAI,CAACD,MAAM,EAAE;MACX,OAAOZ,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAgB,CAAC,CAAC;IAC3D;IAEA,MAAMM,IAAI,GAAG,MAAMjB,IAAI,CAACkB,QAAQ,CAACH,MAAM,CAAC;IACxC,IAAI,CAACE,IAAI,EAAE;MACT,OAAOd,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;MAAiB,CAAC,CAAC;IAC5D;IAEAT,GAAG,CAACe,IAAI,GAAGA,IAAI;IACfb,IAAI,CAAC,CAAC;EACR,CAAC,CAAC,OAAOe,KAAK,EAAE;IACdhB,GAAG,CAACM,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE;IAAiB,CAAC,CAAC;EACrD;AACF,CAAC;AAEDS,MAAM,CAACC,OAAO,GAAG;EACfpB;AACF,CAAC","ignoreList":[]}