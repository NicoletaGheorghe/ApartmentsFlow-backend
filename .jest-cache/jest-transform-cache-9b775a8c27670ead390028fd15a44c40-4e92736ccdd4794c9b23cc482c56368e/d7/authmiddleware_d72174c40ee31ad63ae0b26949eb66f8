ac1e5bc9c6b7489350bdbc5ede65f0d8
const {
  verifyToken
} = require('../utils/jwt');
const User = require('../models/user.model');
const protect = async (req, res, next) => {
  try {
    const authHeader = req.headers.authorization;
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return res.status(401).json({
        message: 'Not authorized'
      });
    }
    const token = authHeader.split(' ')[1];
    const decoded = verifyToken(token);

    // Check for both userId and id in the decoded token
    const userId = decoded.userId || decoded.id;
    if (!userId) {
      return res.status(401).json({
        message: 'Invalid token'
      });
    }
    const user = await User.findById(userId);
    if (!user) {
      return res.status(401).json({
        message: 'User not found'
      });
    }
    req.user = user;
    next();
  } catch (error) {
    res.status(401).json({
      message: 'Not authorized'
    });
  }
};
module.exports = {
  protect
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ2ZXJpZnlUb2tlbiIsInJlcXVpcmUiLCJVc2VyIiwicHJvdGVjdCIsInJlcSIsInJlcyIsIm5leHQiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzdGFydHNXaXRoIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2UiLCJ0b2tlbiIsInNwbGl0IiwiZGVjb2RlZCIsInVzZXJJZCIsImlkIiwidXNlciIsImZpbmRCeUlkIiwiZXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiYXV0aC5taWRkbGV3YXJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmVyaWZ5VG9rZW4gfSA9IHJlcXVpcmUoJy4uL3V0aWxzL2p3dCcpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL3VzZXIubW9kZWwnKTtcclxuXHJcbmNvbnN0IHByb3RlY3QgPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XHJcbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV07XHJcbiAgICBjb25zdCBkZWNvZGVkID0gdmVyaWZ5VG9rZW4odG9rZW4pO1xyXG5cclxuICAgIC8vIENoZWNrIGZvciBib3RoIHVzZXJJZCBhbmQgaWQgaW4gdGhlIGRlY29kZWQgdG9rZW5cclxuICAgIGNvbnN0IHVzZXJJZCA9IGRlY29kZWQudXNlcklkIHx8IGRlY29kZWQuaWQ7XHJcbiAgICBpZiAoIXVzZXJJZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCB0b2tlbicgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlcklkKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcS51c2VyID0gdXNlcjtcclxuICAgIG5leHQoKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnTm90IGF1dGhvcml6ZWQnIH0pO1xyXG4gIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHByb3RlY3QsXHJcbn07XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTTtFQUFFQTtBQUFZLENBQUMsR0FBR0MsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUMvQyxNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztBQUU1QyxNQUFNRSxPQUFPLEdBQUcsTUFBQUEsQ0FBT0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQUksS0FBSztFQUN4QyxJQUFJO0lBQ0YsTUFBTUMsVUFBVSxHQUFHSCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYTtJQUM1QyxJQUFJLENBQUNGLFVBQVUsSUFBSSxDQUFDQSxVQUFVLENBQUNHLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRTtNQUNwRCxPQUFPTCxHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQUVDLE9BQU8sRUFBRTtNQUFpQixDQUFDLENBQUM7SUFDNUQ7SUFFQSxNQUFNQyxLQUFLLEdBQUdQLFVBQVUsQ0FBQ1EsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0QyxNQUFNQyxPQUFPLEdBQUdoQixXQUFXLENBQUNjLEtBQUssQ0FBQzs7SUFFbEM7SUFDQSxNQUFNRyxNQUFNLEdBQUdELE9BQU8sQ0FBQ0MsTUFBTSxJQUFJRCxPQUFPLENBQUNFLEVBQUU7SUFDM0MsSUFBSSxDQUFDRCxNQUFNLEVBQUU7TUFDWCxPQUFPWixHQUFHLENBQUNNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQUVDLE9BQU8sRUFBRTtNQUFnQixDQUFDLENBQUM7SUFDM0Q7SUFFQSxNQUFNTSxJQUFJLEdBQUcsTUFBTWpCLElBQUksQ0FBQ2tCLFFBQVEsQ0FBQ0gsTUFBTSxDQUFDO0lBQ3hDLElBQUksQ0FBQ0UsSUFBSSxFQUFFO01BQ1QsT0FBT2QsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUFFQyxPQUFPLEVBQUU7TUFBaUIsQ0FBQyxDQUFDO0lBQzVEO0lBRUFULEdBQUcsQ0FBQ2UsSUFBSSxHQUFHQSxJQUFJO0lBQ2ZiLElBQUksQ0FBQyxDQUFDO0VBQ1IsQ0FBQyxDQUFDLE9BQU9lLEtBQUssRUFBRTtJQUNkaEIsR0FBRyxDQUFDTSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUFFQyxPQUFPLEVBQUU7SUFBaUIsQ0FBQyxDQUFDO0VBQ3JEO0FBQ0YsQ0FBQztBQUVEUyxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNmcEI7QUFDRixDQUFDIiwiaWdub3JlTGlzdCI6W119